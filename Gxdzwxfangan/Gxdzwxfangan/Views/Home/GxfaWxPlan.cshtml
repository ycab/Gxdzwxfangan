@{

    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <meta name="format-detection" content="telephone=no">
    <title>发布任务</title>
    <link href="@Url.Content("~/gxfa/statics/css/bootstrap.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/font-awesome.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/swiper.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/ectouch.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/photoswipe.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/style.css")" rel="stylesheet" />
    <link href="@Url.Content("~/gxfa/statics/css/user.css")" rel="stylesheet" />
    <script src="@Url.Content("~/gxfa/statics/js/jquery-2.1.4.min.js")"></script>
    <script src="@Url.Content("~/gxfa/statics/js/ectouch.js")"></script>
    <link href="@Url.Content("~/gxfa/statics/css/search.css")" rel="stylesheet" />
    <link href="@Url.Content("~/weui-master/dist/style/weui.css")" rel="stylesheet" />
    <link href="@Url.Content("~/weui-master/dist/style/weui.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/weui-master/dist/example/example.css")" rel="stylesheet" />
    <script src="@Url.Content("~/weui-master/dist/example/example.js")"></script>
    <script src="@Url.Content("~/Scripts/uploadfile/jquery.form.js")"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>
    <script type="text/javascript">var rootUrl = "@Url.Content("~")";//获取根路径，防止iis部署位置不同</script>
    <script>
        var user_id = "@ViewBag.user_id";
    </script>

    <style>
        /*修改了weui的部分样式：*/
        .weui-cells {
            /*margin-top: 1.17647059em;weui原样式，消除了顶部的留白*/
            margin-top: 0em;
            background-color: #FFFFFF;
            line-height: 1.47058824;
            font-size: 17px;
            overflow: hidden;
            position: relative;
        }
    </style>
</head>
<body style="max-width:640px;">
    <div class="con m-b7 new-maxbox">
        <div class="ect-bg">
            <header class="ect-header ect-margin-tb ect-margin-lr text-center ect-bg icon-write">
                <a href="javascript:history.go(-1)" class="pull-left ect-icon ect-icon1 ect-icon-history"></a>
                <span>发布任务</span>
            </header>
        </div>
        <form  id="theForm" name="theForm"  >
            <div class="weui_cells_title">应用领域</div>
            <div class="weui_cells">
                <div class="weui_cell weui_cell_select">
                    <div class="weui_cell_bd weui_cell_primary">
                        <select id="application_area" class="weui_select" name="application_area">
                            <option selected="" value="智能穿戴">智能穿戴</option>
                            <option value="安防监控">安防监控</option>
                            <option value="便携产品">便携产品</option>
                            <option value="工业电子">工业电子</option>
                            <option value="汽车电子">汽车电子</option>
                            <option value="测试设备">测试设备</option>
                            <option value="电源电池">电源电池</option>
                            <option value="机器人无人机">机器人无人机</option>
                            <option value="通信广电">通信广电</option>
                            <option value="游戏玩具">游戏玩具</option>
                            <option value="医疗健康">医疗健康</option>
                            <option value="软件开发">软件开发</option>
                            <option value="智能家居">智能家居</option>
                            <option value="智能家电">智能家电</option>
                            <option value="照明显示">照明显示</option>
                            <option value="工业设计">工业设计</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="weui_cells_title">技术分类</div>
            <div class="weui_cells">
                <div class="weui_cell weui_cell_select">
                    <div class="weui_cell_bd weui_cell_primary">
                        <select id="techical_classificationclass" class="weui_select" name="techical_classificationclass">
                            <option selected="" value="示波器">示波器</option>
                            <option value="开关电源">开关电源</option>
                            <option value="无线充电">无线充电</option>
                            <option value="逻辑器件">逻辑器件</option>
                            <option value="生产设备">生产设备</option>
                            <option value="伺服系统">伺服系统</option>
                            <option value="蓝牙/WiFi测试仪">蓝牙/WiFi测试仪</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="weui_cells_title">任务名称</div>
            <div class="weui_cells weui_cells_form" style="margin-top:0em;">
                <div class="weui_cell">
                    <div class="weui_cell_bd weui_cell_primary">
                        <input id="task_name" name="task_name" class="weui_input" type="text" style="border:none;" placeholder="请填写任务名称" value="" />
                    </div>
                </div>
            </div>
            <div class="weui-cells weui-cells_form" style="margin-top:0em;">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label for="" class="weui-label">日期</label></div>
                    <div class="weui-cell__bd">
                        <input id="deadline" name="deadline"class="weui-input" type="date" value="" />
                    </div>
                </div>
            </div>
            <div class="weui-cells__title">需求描述</div>
            <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <textarea id="demand_description" name="demand_description" class="weui-textarea" placeholder="请填写需求" rows="3"></textarea>
                        <div class="weui-textarea-counter"><span></span></div>
                    </div>
                </div>
            </div>
            <div class="weui-cells__title">详情描述</div>
            <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                    <div class="weui-cell__bd">
                        <textarea id="detail" name="detail" class="weui-textarea" placeholder="请填写任务详情" rows="3"></textarea>
                        <div class="weui-textarea-counter"><span></span></div>
                    </div>
                </div>
            </div>
            <div class="weui-cells weui-cells_form style="margin-top:10em;"">
                <div class="weui-cell weui-cell_vcode">
                    <div class="weui-cell__hd">
                        <label class="weui-label">手机号</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input id="phone"name="phone"class="weui-input" type="tel" placeholder="请输入手机号" />
                    </div>
                    <div class="weui-cell__ft">
                        <button type="button" id="get-code" class="weui-vcode-btn get-code"style="background-color:#1CBB7F;color:#fff">获取验证码</button>
                    </div>
                </div>
                <div class="weui-cell ">
                    <div class="weui-cell__hd"><label class="weui-label">验证码</label></div>
                    <div class="weui-cell__bd">
                        <input id="code"name="code"class="weui-input" type="number" placeholder="请输入验证码" />
                    </div>
                </div>
                <div class="weui-cell ">
                    <div class="weui-cell__hd"><label class="weui-label">价格</label></div>
                    <div class="weui-cell__bd">
                        <input id="price"name="price"class="weui-input" type="number" placeholder="请填写价格" />
                    </div>
                    <div class="weui-cell__hd">
                        <label class="weui-label">元</label>
                    </div>
                </div>
            </div>
            <div class="weui_cells weui-btn-area" id="submit">
                <button  class="btn-submit box-flex submit">
                    提交
                </button>
                <input name="publish_id" type="hidden" value="done" />
            </div>

           </form>

        </div>


    <script type="text/javascript">
        //设置cookie
        function setCookie(cname, cvalue, exdays) {
            var d = new Date();
            d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
            var expires = "expires=" + d.toUTCString();
            document.cookie = cname + "=" + cvalue + "; " + expires;
        }
        function clearHistroy() {
            setCookie('ECS[keywords]', '', -1);
            document.getElementById("search_histroy").style.visibility = "hidden";
        }
    </script>
    <script type="text/javascript">
    $(document).ready(function () {
        $(".open-two-box i").click(function () {
            $(".open-two-box").hide();
        });
    });
    var application_area = "";                //应用领域
    var techical_classificationclass = "";    //技术分类
    var task_name = "";                       //任务名称
    var deadline = "";                        //截止时间
    var demand_description = "";              //需求描述
    var phone = "";                           //手机号码
    var verification_code = "";               //后台传来的验证码
    var code = "";                            //前台输入的验证码
    var price = "";                           //价格
    var detail = "";
    var time_lock = "0";
    $("#get-code").click(function () {
        var mobile = $("#phone").val();
        var phoneinfo = {
            mobile: mobile,
        };
        var available = isPoneAvailable(mobile);
        if (time_lock == "1")//60秒的时间锁
        {
            alert("请稍后再试");
            return false;
        }
        if (available == false) {
            alert("请输入正确11位手机号码");
            return false;
        }
        var url = '@Url.Content("~/Home/Index1")';
        $.ajax({
            type: 'post',
            url: url,
            data: phoneinfo,
            success: function (data) {
                verification_code = data;
                changecode();
            },
            error: function () {
                alert("error");
            }
        });

    });

    function changecode() {
        time_lock = "1";//时间锁
        $("#get-code").html("60秒重新获取").css({ "color": "#fff", "background-color": "#ccc " });
        var endtime = 5;
        var sa = setInterval(function () {
            endtime = endtime.toString().substr(0, 2);
            --endtime;
            $("#get-code").html(endtime + '秒重新获取');

            //$("#timeend").val(endtime);
            if (endtime == 0) {
                time_lock = "0";//时间解锁
                clearInterval(sa);
                $("#get-code").css("background-color", " #1CBB7F");
                $("#get-code").html("获取验证码");
            }
        }, 1000);
    }


    $("#submit").click(function () {
        task_name = $('#task_name').val();
        deadline = $('#deadline').val();
        demand_description = $('#demand_description').val();
        phone = $('#phone').val();
        price = $('#price').val();
        detail = $('#detail').val();
        application_area = $('#application_area').html();
        techical_classificationclass = $('#techical_classificationclass').html();
        code = $('#code').val();
        if (task_name == "") {
            alert("请填写任务名称");
            return false;
        }
        if (code == "" || code != verification_code) {
            alert("验证码错误");
            return false;
        }
        if (isPoneAvailable(phone) == false) {
            alert("请输入正确的手机号码");
            return false;
        }
        else if (price == "") {
            alert("请输入价格");
            return false;
        }
        var taskinfo = {
            application_area: application_area,
            phone: phone,
            task_name: task_name,
            deadline: deadline,
            demand_description: demand_description,
            phone: phone,
            price: price,
            detail: detail,
            techical_classificationclass: techical_classificationclass,

        };
                @*var url = '@Url.Content("~/Home/SendTask")';
                $.ajax({
                    type: 'post',
                    url: url,
                    data: taskinfo,
                    success: function (data) {
                        if (data == "ok") {
                            alert("发布成功");
                        }
                        else if (data == "needfinish") {
                            alert("发布失败,请先完善会员信息");
                            var url = '@Url.Content("~/Home/RediretToFinish")';
                            window.location.href = url;
                        }

                        else {
                            alert("发布失败,请先注册");
                            var url = '@Url.Content("~/Home/Rediret")';
                            window.location.href = url;
                        }
                    },
                    error: function () {
                        alert("error");
                    }
                });*@
                $.ajax({
                    type: 'post',
                    url: rootUrl + "Home/SendTask?random=" + Math.floor(Math.random() * (100000 + 1)),
                    data: $("#theForm").serialize(),
                    dataType: 'text',
                    async: true,
                    success: function (data) {
                        if (data == "ok") {
                            alert("发布成功");
                            var url = '@Url.Content("~/Home/GxfaWxFl")';
                            window.location.href = url;
                        }else
                        {
                            alert("发布失败");
                        }
                    },
                    error: function () {
                        alert("error");
                    }

                })
                return false;
            })
        function isPoneAvailable(str) {
            var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
            if (!myreg.test(str)) {
                return false;
            } else {
                return true;
            }
        }

    </script>
    
</body>
</html>